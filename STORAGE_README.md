# 存储方式说明

本应用支持两种数据存储方式：**数据库存储** 和 **文件存储**。

## 存储方式对比

| 特性 | 数据库存储 | 文件存储 |
|------|-----------|---------|
| 默认方式 | ✅ 是（推荐） | ❌ 否 |
| 数据持久化 | ✅ 持久化到数据库 | ⚠️ 存储在 /tmp 目录，重启后可能丢失 |
| 性能 | ✅ 高性能，适合大量数据 | ⚠️ 适合少量数据 |
| 可靠性 | ✅ 高，支持事务 | ⚠️ 中，依赖文件系统 |
| 备份方式 | ✅ 数据库自动备份 | ⚠️ 需手动备份 JSON 文件 |
| 适用场景 | 生产环境、大量数据 | 开发环境、测试环境 |

## 切换存储方式

### 方式一：使用数据库存储（默认，推荐）

数据库存储是默认的存储方式，无需任何配置。

特点：
- 数据持久化到 PostgreSQL 数据库
- 支持大规模数据存储
- 高性能查询和事务支持
- 数据更安全可靠

### 方式二：使用文件存储

如需使用文件存储（例如在本地开发环境），设置环境变量：

```bash
export STORAGE_TYPE=file
```

或在 `.env` 文件中添加：
```env
STORAGE_TYPE=file
```

特点：
- 数据存储在 `/tmp/data/products.json` 文件中
- 无需数据库配置
- 适合快速开发和测试
- 系统重启后数据可能丢失，需要定期备份

## 数据备份与恢复

无论使用哪种存储方式，都支持导出和导入功能。

### 导出数据
1. 打开应用
2. 点击"产品库管理"
3. 点击"导出"按钮
4. 浏览器将下载 JSON 格式的备份文件

### 导入数据
1. 打开应用
2. 点击"产品库管理"
3. 点击"导入"按钮
4. 选择之前导出的 JSON 文件
5. 系统将恢复产品数据

## 部署环境说明

### 开发环境
- 默认使用数据库存储
- 也可以切换到文件存储进行测试

### 部署环境
- 推荐使用数据库存储
- 部署时自动同步数据库表结构
- 数据自动持久化，无需手动配置

## 注意事项

1. **数据备份**：定期导出数据备份，防止意外丢失
2. **存储方式切换**：切换存储方式后，数据不会自动迁移，需要通过导出导入功能手动迁移
3. **文件存储限制**：使用文件存储时，数据存储在 `/tmp` 目录，系统重启后可能丢失
4. **并发安全**：文件存储在高并发场景下可能存在性能问题，建议使用数据库存储

## API 使用

所有 API 路由都统一使用存储适配器，自动根据环境变量选择存储方式。

- `GET /api/products` - 获取产品列表
- `POST /api/products` - 创建产品
- `PUT /api/products/[id]` - 更新产品
- `DELETE /api/products/[id]` - 删除产品
- `GET /api/products/export` - 导出产品数据
- `POST /api/products/import` - 导入产品数据

## 技术栈

- **数据库存储**: PostgreSQL + Drizzle ORM
- **文件存储**: JSON 文件（存储在 /tmp/data 目录）
- **存储适配器**: 统一接口，支持两种存储方式无缝切换
