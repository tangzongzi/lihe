# ç¤¼ç›’æŠ¥ä»·è®¡ç®—å™¨ï¼ˆEdgeOne Pages ä¼˜åŒ–ç‰ˆï¼‰

ä¸€ä¸ªåŸºäº Next.js çš„ç¤¼ç›’æŠ¥ä»·è®¡ç®—ç³»ç»Ÿï¼Œ**ä¸“ä¸ºè…¾è®¯ EdgeOne Pages å¹³å°ä¼˜åŒ–**ï¼Œå®Œå…¨å…¼å®¹ Edge Runtimeã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **äº§å“ç®¡ç†**ï¼šæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤äº§å“ä¿¡æ¯
- âœ… **ä»·æ ¼è®¡ç®—**ï¼šè‡ªåŠ¨è®¡ç®—æˆæœ¬ã€è¿è´¹ã€æ‰‹ç»­è´¹å’Œåˆ©æ¶¦
- âœ… **ä¼˜æƒ è®¡ç®—**ï¼šæ”¯æŒæŒ‰ç™¾åˆ†æ¯”è®¡ç®—ä¼˜æƒ é‡‘é¢
- âœ… **æ•°æ®å¯¼å…¥å¯¼å‡º**ï¼šæ”¯æŒ JSON æ ¼å¼çš„æ•°æ®å¤‡ä»½å’Œæ¢å¤
- âœ… **OCR è¯†åˆ«**ï¼šé€šè¿‡ Tesseract.js å‰ç«¯è¯†åˆ«äº§å“ä¿¡æ¯
- âœ… **Edge Runtime**ï¼šå®Œå…¨å…¼å®¹ EdgeOne Pages å¹³å°

## ğŸš€ æŠ€æœ¯æ ˆ

### å‰ç«¯
- Next.js 16 (App Router)
- React 19
- TypeScript 5
- Tailwind CSS 4
- Radix UI
- Tesseract.js (OCR)

### åç«¯ï¼ˆEdge Runtimeï¼‰
- Next.js API Routes (Edge Runtime)
- Neon Database Serverless
- Drizzle ORM
- Zod éªŒè¯

### éƒ¨ç½²
- EdgeOne Pages
- GitHub è‡ªåŠ¨éƒ¨ç½²
- ç¯å¢ƒå˜é‡ç®¡ç†

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/tangzongzi/lihe.git
cd lihe
```

### 2. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env`ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ï¼š

```env
DATABASE_URL=postgresql://user:password@host.neon.tech/dbname?sslmode=require
```

### 4. åˆå§‹åŒ–æ•°æ®åº“

```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
pnpm db:generate

# åº”ç”¨è¿ç§»åˆ°æ•°æ®åº“
pnpm db:push
```

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

è®¿é—® [http://localhost:3000](http://localhost:3000) æŸ¥çœ‹åº”ç”¨ã€‚

## ğŸ—„ï¸ æ•°æ®åº“è®¾ç½®

### ä½¿ç”¨ Neon Databaseï¼ˆæ¨èï¼‰

1. æ³¨å†Œ [Neon](https://neon.tech)ï¼ˆå…è´¹å±‚å¯ç”¨ï¼‰
2. åˆ›å»ºæ–°é¡¹ç›®
3. è·å–è¿æ¥å­—ç¬¦ä¸²
4. é…ç½®åˆ° `.env` æ–‡ä»¶çš„ `DATABASE_URL`
5. è¿è¡Œ `pnpm db:push` åˆ›å»ºè¡¨

### æ•°æ®åº“ Schema

```sql
CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  supply_price TEXT NOT NULL,
  shop_price TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);
```

## ğŸ“ è®¡ç®—è§„åˆ™

### è´¹ç”¨è®¡ç®—

- **å•†å“æˆæœ¬** = ä¾›è´§ä»· Ã— æ•°é‡
- **ä¾›è´§å•†è¿è´¹**ï¼š
  - 1ä»¶ï¼š3å…ƒ
  - 2ä»¶ï¼š5å…ƒ
  - 3ä»¶åŠä»¥ä¸Šï¼šå…è¿è´¹
- **å®¢æˆ·è¿è´¹**ï¼š
  - 1ä»¶ï¼šè®¾å®šçš„å•ä»¶è¿è´¹
  - å¤šä»¶ï¼šæ¯ä»¶è¿è´¹ Ã— æ•°é‡
- **å®¢æˆ·å®ä»˜** = (åº—é“ºå”®ä»· Ã— æ•°é‡) + å®¢æˆ·è¿è´¹
- **æ‰‹ç»­è´¹** = å®¢æˆ·å®ä»˜ Ã— 0.6%
- **åˆ©æ¶¦** = å®¢æˆ·å®ä»˜ - æ‰‹ç»­è´¹ - å•†å“æˆæœ¬ - ä¾›è´§å•†è¿è´¹

### ä¼˜æƒ è®¡ç®—

- **æœ€å¤§å¯ä¼˜æƒ ** = å®¢æˆ·å®ä»˜ - (å•†å“æˆæœ¬ + ä¾›è´§å•†è¿è´¹) Ã· 0.994
- ä¼˜æƒ ååˆ©æ¶¦ä¸º 0ï¼ˆç›ˆäºå¹³è¡¡ç‚¹ï¼‰

## ğŸŒ éƒ¨ç½²åˆ° EdgeOne Pages

### 1. å‡†å¤‡å·¥ä½œ

- GitHub ä»“åº“
- Neon Database è´¦å·å’Œè¿æ¥å­—ç¬¦ä¸²

### 2. éƒ¨ç½²æ­¥éª¤

1. æ¨é€ä»£ç åˆ° GitHub
2. åœ¨ [EdgeOne Pages æ§åˆ¶å°](https://edgeone.ai/pages) è¿æ¥ä»“åº“
3. é…ç½®æ„å»ºè®¾ç½®ï¼š
   - **æ„å»ºå‘½ä»¤**ï¼š`pnpm install && pnpm build`
   - **è¾“å‡ºç›®å½•**ï¼š`.next`
   - **Node ç‰ˆæœ¬**ï¼š18.x æˆ– 20.x
4. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   - `DATABASE_URL`ï¼šä½ çš„ Neon æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
5. ç‚¹å‡»éƒ¨ç½²
6. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰
7. è®¿é—®åˆ†é…çš„åŸŸå

### 3. è‡ªåŠ¨éƒ¨ç½²

- Git push è‡ªåŠ¨è§¦å‘éƒ¨ç½²
- æ”¯æŒé¢„è§ˆéƒ¨ç½²ï¼ˆPRï¼‰
- æ”¯æŒå›æ»šåˆ°å†å²ç‰ˆæœ¬

## ğŸ”§ å¼€å‘

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm build
```

### å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

```bash
pnpm start
```

### ä»£ç æ£€æŸ¥

```bash
pnpm lint
```

### ç±»å‹æ£€æŸ¥

```bash
pnpm ts-check
```

### æ•°æ®åº“ç®¡ç†

```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
pnpm db:generate

# åº”ç”¨è¿ç§»
pnpm db:push

# æ‰“å¼€ Drizzle Studioï¼ˆæ•°æ®åº“ GUIï¼‰
pnpm db:studio
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±ï¼ˆEdge Runtimeï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ products/      # äº§å“ CRUD API
â”‚   â”‚   â”‚   â”œâ”€â”€ calculate/     # ä»·æ ¼è®¡ç®— API
â”‚   â”‚   â”‚   â””â”€â”€ import-export/ # å¯¼å…¥å¯¼å‡º API
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # å…¨å±€å¸ƒå±€
â”‚   â”‚   â””â”€â”€ page.tsx           # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ui/               # UI ç»„ä»¶åº“
â”‚   â”œâ”€â”€ db/                   # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ client.ts         # Neon å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ schema.ts         # æ•°æ®åº“ Schema
â”‚   â”‚   â””â”€â”€ queries.ts        # æŸ¥è¯¢å‡½æ•°
â”‚   â””â”€â”€ lib/                  # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ api-types.ts      # API ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ ocr.ts            # OCR å¤„ç†
â”œâ”€â”€ drizzle/                  # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ drizzle.config.ts         # Drizzle é…ç½®
â””â”€â”€ package.json              # ä¾èµ–é…ç½®
```

## ğŸ”‘ ç¯å¢ƒå˜é‡

```env
# æ•°æ®åº“è¿æ¥ï¼ˆå¿…å¡«ï¼‰
DATABASE_URL=postgresql://user:password@host.neon.tech/dbname?sslmode=require

# å¯é€‰é…ç½®
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-domain.edgeone.app
```

## ğŸ¯ Edge Runtime å…¼å®¹æ€§

æœ¬é¡¹ç›®å®Œå…¨å…¼å®¹ Edge Runtimeï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

- âœ… æ‰€æœ‰ API è·¯ç”±å£°æ˜ `export const runtime = 'edge'`
- âœ… ä½¿ç”¨ `@neondatabase/serverless` è¿æ¥æ•°æ®åº“
- âœ… é¿å…ä½¿ç”¨ Node.js ç‰¹å®šæ¨¡å—ï¼ˆfs, path, cryptoï¼‰
- âœ… ä½¿ç”¨ Web æ ‡å‡† API
- âœ… åŒ…ä½“ç§¯ < 2MB

## ğŸ“¸ OCR è¯†åˆ«åŠŸèƒ½

### ä½¿ç”¨æ–¹æ³•

1. ç‚¹å‡»"æ·»åŠ äº§å“"æŒ‰é’®
2. ä¸Šä¼ äº§å“å›¾ç‰‡æˆ–ç²˜è´´å›¾ç‰‡ï¼ˆCtrl+Vï¼‰
3. ç‚¹å‡»"è¯†åˆ«"æŒ‰é’®
4. è‡ªåŠ¨å¡«å……äº§å“åç§°å’Œä»·æ ¼
5. æ‰‹åŠ¨è°ƒæ•´è¯†åˆ«ç»“æœ
6. ä¿å­˜äº§å“

### è¯†åˆ«è§„åˆ™

- **äº§å“åç§°**ï¼šæå–ç¬¬ä¸€è¡ŒåŒ…å«ä¸­æ–‡çš„è¾ƒé•¿æ–‡å­—
- **ä»·æ ¼**ï¼šè¯†åˆ« Â¥ ç¬¦å·ã€"å…ƒ"å­—ã€"ä¾›è´§ä»·"å…³é”®è¯é™„è¿‘çš„æ•°å­—
- **è§„æ ¼**ï¼šè¯†åˆ«åŒ…å« * æˆ– Ã— ä»¥åŠ g æˆ– å…‹çš„è¡Œ

### ä¼˜åŒ–å»ºè®®

- ä½¿ç”¨æ¸…æ™°çš„å›¾ç‰‡
- æ–‡å­—æ°´å¹³æ’åˆ—
- èƒŒæ™¯ç®€å•å¹²å‡€
- å…‰çº¿å……è¶³

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `DATABASE_URL` ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æ•°æ®åº“å…è®¸æ¥è‡ª EdgeOne çš„è¿æ¥
- æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™

### 2. æ„å»ºå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è¿è¡Œ `pnpm install` é‡æ–°å®‰è£…ä¾èµ–
- æ£€æŸ¥ Node ç‰ˆæœ¬ï¼ˆéœ€è¦ 18.x æˆ– 20.xï¼‰
- æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

### 3. OCR è¯†åˆ«ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ›´æ¸…æ™°çš„å›¾ç‰‡
- ç¡®ä¿æ–‡å­—æ°´å¹³æ’åˆ—
- æé«˜å›¾ç‰‡å¯¹æ¯”åº¦
- æ‰‹åŠ¨è°ƒæ•´è¯†åˆ«ç»“æœ

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ”— ç›¸å…³é“¾æ¥

- [EdgeOne Pages æ–‡æ¡£](https://edgeone.ai/pages)
- [Neon Database æ–‡æ¡£](https://neon.tech/docs)
- [Next.js æ–‡æ¡£](https://nextjs.org/docs)
- [Drizzle ORM æ–‡æ¡£](https://orm.drizzle.team)

## ğŸ“ è”ç³»æ–¹å¼

- GitHub: [tangzongzi/lihe](https://github.com/tangzongzi/lihe)
- é—®é¢˜åé¦ˆ: [Issues](https://github.com/tangzongzi/lihe/issues)
